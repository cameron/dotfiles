#! /bin/bash

# support for multiple sessions / monitors

sessions=$(tmux list-sessions | grep $TMUX_PROJECT | grep -v attached)

if [ $? -eq 1 ]; then

    sessionName=$TMUX_PROJECT-`date +%s`
    tmux \
        new-session -t $TMUX_PROJECT -s $sessionName \;\
        attach -d -t $sessionName \;\
        select-window -t 2
    exit 0
fi

tmux ls
tmux attach -d -t $TMUX_PROJECT

if [[ -f ~/.tmux.cleanup ]]; then
	~/.tmux.cleanup
fi

# TODO this runs only when the first session exits; should run when only remaining session quites
if [[ -f .tmux.cleanup ]]; then
  ./.tmux.cleanup
fi
